<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bol AI | Auto APK Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .input-dark { background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; width: 100%; }
        .btn-grad { background: linear-gradient(90deg, #10b981 0%, #059669 100%); }
    </style>
</head>
<body class="min-h-screen p-6 flex flex-col items-center">

    <div class="max-w-5xl w-full">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500">
                Bol AI APK Builder
            </h1>
            <p class="text-slate-400 mt-2">Source Code + Auto APK Build System (GitHub Actions)</p>
        </header>

        <div class="glass p-8 rounded-2xl shadow-2xl">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Inputs -->
                <div class="space-y-4">
                    <div>
                        <label class="text-green-400 font-bold text-sm">App Name</label>
                        <input type="text" id="appName" value="My BolAI App" class="input-dark">
                    </div>
                    <div>
                        <label class="text-green-400 font-bold text-sm">Package Name</label>
                        <input type="text" id="pkgName" value="com.myapp.bol.ai.maker" class="input-dark">
                    </div>
                    <div>
                        <label class="text-green-400 font-bold text-sm">App Icon</label>
                        <input type="file" id="appIcon" accept="image/*" class="input-dark cursor-pointer">
                    </div>
                    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                        <h3 class="text-yellow-400 font-bold text-sm mb-2">⚠️ APK कैसे मिलेगा?</h3>
                        <ol class="list-decimal list-inside text-xs text-slate-300 space-y-1">
                            <li>नीचे दिए बटन से <b>ZIP डाउनलोड</b> करें।</li>
                            <li>ZIP को Extract करें और GitHub पर अपलोड करें।</li>
                            <li>GitHub Actions टैब में जाएं।</li>
                            <li>वहाँ <b>Automatic APK Build</b> शुरू हो जाएगा।</li>
                        </ol>
                    </div>
                </div>

                <!-- Code Editor -->
                <div class="flex flex-col">
                    <label class="text-green-400 font-bold text-sm mb-2">Index.html Code</label>
                    <textarea id="userHtml" class="input-dark h-64 font-mono text-xs text-green-300" placeholder="Paste your HTML code here..."></textarea>
                </div>
            </div>

            <button onclick="generateProject()" id="btn" class="mt-8 w-full btn-grad text-white font-bold py-4 rounded-xl shadow-lg hover:scale-[1.02] transition-transform">
                Download Project ZIP (With APK Builder)
            </button>
            
            <p id="status" class="text-center text-green-400 mt-4 hidden font-mono text-sm">Processing... Please wait...</p>
        </div>
    </div>

    <script>
        // --- JAVA CODE CONSTANTS (FULL CODE) ---
        const JAVA_MAIN = `package PKG_NAME;
import android.app.Activity;
import android.app.DownloadManager;
import android.content.*;
import android.graphics.Bitmap;
import android.net.Uri;
import android.os.Bundle;
import android.os.Environment;
import android.webkit.*;
import android.widget.Toast;
public class MainActivity extends Activity {
    private WebView webview1;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        webview1 = findViewById(R.id.webview1);
        WebSettings webSettings = webview1.getSettings();
        webSettings.setJavaScriptEnabled(true);
        webSettings.setDomStorageEnabled(true);
        webSettings.setAllowFileAccess(true);
        webSettings.setAllowContentAccess(true);
        
        webview1.setWebViewClient(new WebViewClient());
        webview1.setWebChromeClient(new WebChromeClient());
        
        webview1.addJavascriptInterface(new Object() {
            @JavascriptInterface
            public void copyToClipboard(String text) {
                ClipboardManager clipboard = (ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);
                ClipData clip = ClipData.newPlainText("Copied Text", text);
                clipboard.setPrimaryClip(clip);
                Toast.makeText(MainActivity.this, "Copied!", Toast.LENGTH_SHORT).show();
            }
        }, "JSInterface");

        webview1.setDownloadListener((url, userAgent, contentDisposition, mimetype, contentLength) -> {
            DownloadManager.Request request = new DownloadManager.Request(Uri.parse(url));
            request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED);
            request.setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, URLUtil.guessFileName(url, contentDisposition, mimetype));
            ((DownloadManager) getSystemService(DOWNLOAD_SERVICE)).enqueue(request);
            Toast.makeText(getApplicationContext(), "Downloading...", Toast.LENGTH_SHORT).show();
        });

        webview1.loadUrl("file:///android_asset/index.html");
    }
}`;

        const JAVA_APP = `package PKG_NAME;
import android.app.Application;
import android.content.Context;
public class BolAiAppMakermain extends Application {
    private static Context mApplicationContext;
    public static Context getContext() { return mApplicationContext; }
    @Override
    public void onCreate() {
        super.onCreate();
        mApplicationContext = getApplicationContext();
    }
}`;

        const JAVA_UTILS = `package PKG_NAME;
import android.content.Context;
import android.widget.Toast;
public class SketchwareUtil {
    public static void showMessage(Context c, String s) { Toast.makeText(c, s, Toast.LENGTH_SHORT).show(); }
    public static int getDisplayWidthPixels(Context c) { return c.getResources().getDisplayMetrics().widthPixels; }
    public static int getDisplayHeightPixels(Context c) { return c.getResources().getDisplayMetrics().heightPixels; }
}`;

        const JAVA_FILE = `package PKG_NAME;
import java.io.File;
public class FileUtil {
    public static boolean isExistFile(String path) { return new File(path).exists(); }
    public static void makeDir(String path) { new File(path).mkdirs(); }
}`;

        // --- GITHUB ACTIONS WORKFLOW (THE MAGIC PART) ---
        const GITHUB_WORKFLOW = `name: Build APK

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle

      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      - name: Build Debug APK
        run: ./gradlew assembleDebug

      - name: Upload APK
        uses: actions/upload-artifact@v3
        with:
          name: app-debug
          path: app/build/outputs/apk/debug/app-debug.apk`;

        async function generateProject() {
            const appName = document.getElementById('appName').value;
            const pkg = document.getElementById('pkgName').value;
            const html = document.getElementById('userHtml').value || "<h1>Hello Bol AI</h1>";
            const icon = document.getElementById('appIcon').files[0];
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');

            if(!pkg.includes('.')) { alert("Invalid Package Name"); return; }

            btn.disabled = true;
            status.classList.remove('hidden');

            const zip = new JSZip();
            const pkgPath = pkg.replace(/\./g, '/');

            // 1. GITHUB ACTIONS FILE (Auto APK Builder)
            zip.file(".github/workflows/build.yml", GITHUB_WORKFLOW);
            zip.file("README.txt", "To get your APK:\n1. Upload these files to GitHub.\n2. Go to 'Actions' tab.\n3. Wait for build to finish.\n4. Download 'app-debug' artifact.");

            // 2. GRADLE SETUP
            zip.file("build.gradle", `buildscript { repositories { google(); mavenCentral() } dependencies { classpath 'com.android.tools.build:gradle:8.1.0' } } allprojects { repositories { google(); mavenCentral() } } tasks.register("clean", Delete) { delete rootProject.buildDir }`);
            zip.file("settings.gradle", `include ':app'`);
            zip.file("gradle.properties", `android.useAndroidX=true\nandroid.enableJetifier=true`);
            
            // Gradlew Wrapper (Essential for CI/CD)
            const gradleWrapper = zip.folder("gradle").folder("wrapper");
            gradleWrapper.file("gradle-wrapper.properties", "distributionBase=GRADLE_USER_HOME\ndistributionPath=wrapper/dists\ndistributionUrl=https\\://services.gradle.org/distributions/gradle-8.0-bin.zip\nzipStoreBase=GRADLE_USER_HOME\nzipStorePath=wrapper/dists");

            // 3. APP MODULE
            const app = zip.folder("app");
            app.file("build.gradle", `plugins { id 'com.android.application' }\nandroid {\n    namespace "${pkg}"\n    compileSdk 34\n    defaultConfig {\n        applicationId "${pkg}"\n        minSdkVersion 21\n        targetSdkVersion 34\n        versionCode 1\n        versionName "1.0"\n    }\n}\ndependencies {\n    implementation 'androidx.appcompat:appcompat:1.6.1'\n}`);

            // 4. SOURCE CODE
            const main = app.folder("src").folder("main");
            main.file("AndroidManifest.xml", `<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-permission android:name="android.permission.INTERNET"/>
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/>
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
    <application android:name=".BolAiAppMakermain" android:label="${appName}" android:icon="@mipmap/ic_launcher" android:theme="@android:style/Theme.DeviceDefault.NoActionBar">
        <activity android:name=".MainActivity" android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
        </activity>
    </application>
</manifest>`);

            main.folder("assets").file("index.html", html);

            const java = main.folder("java").folder(pkgPath);
            const replacePkg = (code) => code.replaceAll("PKG_NAME", pkg);

            java.file("MainActivity.java", replacePkg(JAVA_MAIN));
            java.file("BolAiAppMakermain.java", replacePkg(JAVA_APP));
            java.file("SketchwareUtil.java", replacePkg(JAVA_UTILS));
            java.file("FileUtil.java", replacePkg(JAVA_FILE));

            // 5. RESOURCES
            const res = main.folder("res");
            res.folder("layout").file("main.xml", `<?xml version="1.0" encoding="utf-8"?>\n<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent"><WebView android:id="@+id/webview1" android:layout_width="match_parent" android:layout_height="match_parent"/></LinearLayout>`);
            res.folder("values").file("strings.xml", `<resources><string name="app_name">${appName}</string></resources>`);

            // Icon
            const mipmap = res.folder("mipmap-xhdpi");
            if(icon) {
                const buf = await icon.arrayBuffer();
                mipmap.file("ic_launcher.png", buf);
            } else {
                mipmap.file("ic_launcher.png", new Uint8Array([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,1,0,0,0,1,8,6,0,0,0,31,21,196,137,0,0,0,10,73,68,65,84,120,156,99,0,1,0,0,5,0,1,13,10,45,180,0,0,0,0,73,69,78,68,174,66,96,130]));
            }

            // Generate
            zip.generateAsync({type:"blob"}).then(content => {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(content);
                a.download = "BolAI_Project_With_AutoBuild.zip";
                a.click();
                btn.disabled = false;
                status.innerText = "ZIP Downloaded! Now upload to GitHub to get APK.";
            });
        }
    </script>
</body>
</html>
