<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bol AI - SWB Project Generator</title>
    <!-- JSZip Library (Required for creating the file) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
        :root {
            --primary: #ff5722;
            --dark: #212121;
            --light: #f5f5f5;
        }
        body {
            font-family: sans-serif;
            background-color: var(--light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }
        h2 {
            color: var(--dark);
            margin-bottom: 20px;
        }
        .upload-box {
            border: 2px dashed #ddd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: left;
            transition: 0.3s;
        }
        .upload-box:hover {
            border-color: var(--primary);
            background: #fffbfb;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }
        input[type="file"] {
            width: 100%;
            font-size: 14px;
        }
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 87, 34, 0.3);
            transition: transform 0.2s;
            width: 100%;
        }
        button:hover {
            transform: translateY(-2px);
            background-color: #e64a19;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #status {
            margin-top: 15px;
            font-size: 14px;
            color: #333;
        }
        .note {
            font-size: 12px;
            color: #888;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="card">
    <h2>SWB Generator</h2>
    <p style="color:#666; margin-bottom:25px;">Upload assets to create a Sketchware Project (.swb)</p>

    <div class="upload-box">
        <label>1. App Icon (Image)</label>
        <input type="file" id="iconInput" accept="image/*">
    </div>

    <div class="upload-box">
        <label>2. Website Code (index.html)</label>
        <input type="file" id="htmlInput" accept=".html">
    </div>

    <button id="genBtn" onclick="createSWB()">Download .swb File</button>
    <div id="status"></div>
    <div class="note">Files will be merged with BolAi config automatically.</div>
</div>

<script>
    // --- STATIC CONFIGURATION FILES (EXACTLY AS PROVIDED) ---
    
    const file_project_config = `{"min_sdk":"26","enable_bridgeless_themes":"false","enable_viewbinding":"false","app_class":".BolAiAppMakermain","target_sdk":"35","disable_old_methods":"false"}`;
    
    const file_permission = `["android.permission.INTERNET","android.permission.WRITE_EXTERNAL_STORAGE","android.permission.READ_EXTERNAL_STORAGE"]`;
    
    const file_icon_data = `{"textures":false,"selected_texture":0,"scale":1.0,"corners":60.0,"gradient_background_type":false,"icon_size":250.0,"text":"","badge_text_color":16777215,"gradient_direction":"BOTTOM_TOP","score_effect":false,"icon_hp":0.0,"gradient_color2":0,"gradient_color1":16777215,"rotation":150.0,"text_hp":0.0,"badge_bg_color":0,"texture_color":16777215,"icon_vp":0.0,"text_vp":0.0,"badge":"","background_color":16777215,"text_size":100.0,"adaptive_icon":false,"text_color":0,"opacity":180.0,"icon_color_filter":16777215}`;
    
    const file_proguard_rules = `-repackageclasses
-ignorewarnings
-dontwarn
-dontnote`;

    const file_proguard = `{"debug":"false","enabled":"false"}`;
    const file_stringfog = `{"enabled":"false"}`;
    const file_local_library = ``; 
    const file_custom_blocks = `[]`;

    // --- SAFETY FILES (To prevent Restore Errors) ---
    // Sketchware needs these even if empty
    const file_logic = `[]`;
    const file_view = `[]`;
    const file_library = `[]`;
    const file_resource = `[]`;

    async function createSWB() {
        const iconInput = document.getElementById('iconInput');
        const htmlInput = document.getElementById('htmlInput');
        const status = document.getElementById('status');
        const btn = document.getElementById('genBtn');

        if (!iconInput.files[0] || !htmlInput.files[0]) {
            alert("Please select both an Icon and an HTML file!");
            return;
        }

        btn.disabled = true;
        btn.innerText = "Processing...";
        status.innerText = "Generating project structure...";

        try {
            const zip = new JSZip();

            // 1. Create 'data' folder structure (CRITICAL for Sketchware)
            // We don't create a root folder, we put 'data' directly at the top level of the zip
            
            // --- Add Static Config Files ---
            zip.file("data/project_config", file_project_config);
            zip.file("data/permission", file_permission);
            zip.file("data/proguard-rules.pro", file_proguard_rules);
            zip.file("data/proguard", file_proguard);
            zip.file("data/stringfog", file_stringfog);
            zip.file("data/local_library", file_local_library);
            zip.file("data/custom_blocks", file_custom_blocks);
            
            // --- Add Safety Files (Prevents Crash) ---
            zip.file("data/logic", file_logic);
            zip.file("data/view", file_view);
            zip.file("data/library", file_library);
            zip.file("data/resource", file_resource);

            // --- Add App Icon Data ---
            zip.file("data/files/app-icon/data.json", file_icon_data);

            // --- Add User's HTML File ---
            const htmlContent = await readFile(htmlInput.files[0]);
            zip.file("data/files/assets/index.html", htmlContent);

            // --- Add User's Icon Image ---
            // Rename it to icon.png regardless of original name
            const iconBuffer = await readFileBuffer(iconInput.files[0]);
            zip.file("data/files/app-icon/icon.png", iconBuffer);

            // --- Generate .swb File ---
            status.innerText = "Compressing...";
            const content = await zip.generateAsync({type: "blob"});
            
            // --- Trigger Download ---
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            link.download = "project.swb"; // Extension is .swb
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            status.innerText = "Success! File downloaded.";
            btn.innerText = "Download Again";
            btn.disabled = false;

        } catch (err) {
            console.error(err);
            status.innerText = "Error: " + err.message;
            btn.disabled = false;
            btn.innerText = "Try Again";
        }
    }

    // Helper: Read file as Text
    function readFile(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsText(file);
        });
    }

    // Helper: Read file as ArrayBuffer (for Images)
    function readFileBuffer(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsArrayBuffer(file);
        });
    }
</script>

</body>
</html>
